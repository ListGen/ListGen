/* MQ PMA Creator - Util
 * Author: bhuelga
 */

// local data of session
var agentData = {
	'default-mls-area' : 'CARMEL HIGHLANDS',
	'mls-area-names' : ['CARMEL HIGHLANDS', 'PEBBLE BEACH'],
	'mls-areas' : {
		'CARMEL HIGHLANDS' : {
			'page-version' : '4',
			'edit-sections' : {
				'Attention Grabber' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Front Graph' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Front Bar' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Top Image' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'City Highlights' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Area Highlights' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Call To Action' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Inside Bar' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Listings And Sales' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
			},
			'homeowners' : [
				{	
					'address-id' : '0000',
					'name' : 'Brandon Huelga',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '531 Lasuen Mall',
					'last-sale-price' : 1.8,
					'last-sale-date' : '10/10/2018',
					'selling-agent' : 'Kyle Morrison',
					'blocked' : 'Agent-Blocked',
					'past-client' : true,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0001',
					'name' : 'Kyle Morrison',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '18B E Carmel Valley Rd',
					'last-sale-price' : 2.2,
					'last-sale-date' : '2/07/2017',
					'selling-agent' : 'Kyle Morrison',
					'blocked' : '',
					'past-client' : true,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0002',
					'name' : 'Bill Jones',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '1215 Santa Barbara Lane',
					'last-sale-price' : 6.2,
					'last-sale-date' : '5/21/2012',
					'selling-agent' : 'Seamus Riley',
					'blocked' : 'Active Listing',
					'past-client' : false,
					'parcel-number' : '111-332-494'

				},
				{	
					'address-id' : '0003',
					'name' : 'Tom Hanks',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '1992 Wilson Place',
					'last-sale-price' : 10.875,
					'last-sale-date' : '6/23/1991',
					'selling-agent' : 'Meryl Streep',
					'blocked' : 'Returned Mail',
					'past-client' : false,
					'parcel-number' : '111-332-494'

				},
				{	
					'address-id' : '0004',
					'name' : 'Mario Luigi',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '1984 Rainbow Rd',
					'last-sale-price' : .35,
					'last-sale-date' : '5/21/2013',
					'selling-agent' : 'Seamus Riley',
					'blocked' : '',
					'past-client' : false,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0005',
					'name' : 'Ellen Ripley',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '7 Nostrodamus',
					'last-sale-price' : 22000,
					'last-sale-date' : '5/25/1979',
					'selling-agent' : 'Ridley Scott',
					'blocked' : 'Homeowner-Blocked',
					'past-client' : false,
					'parcel-number' : '111-332-494'
				}
			],
			'final-preview' : {
				'Attention Grabber' : {
					'time-confirmed' : ''
				},
				'Front Graph' : {
					'time-confirmed' : ''
				},
				'Front Bar' : {
					'time-confirmed' : ''
				},
				'Top Image' : {
					'time-confirmed' : ''
				},
				'City Highlights' : {
					'time-confirmed' : ''
				},
				'Area Highlights' : {
					'time-confirmed' : ''
				},
				'Call To Action' : {
					'time-confirmed' : ''
				},
				'Inside Bar' : {
					'time-confirmed' : ''
				},
				'Listings And Sales' : {
					'time-confirmed' : ''
				}
			},
			'editor-complete' : false,
			'mailing-complete' : false,
			'total-complete' : false,
			'unblocked-mailings' : 0
		},
		'PEBBLE BEACH' : {
			'page-version' : '4',
			'edit-sections' : {
				'Attention Grabber' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Front Graph' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Front Bar' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Top Image' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'City Highlights' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Area Highlights' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Call To Action' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Inside Bar' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
				'Listings And Sales' : {
					'selection' : '',
					'confirmed-selection' : '',
					'status' : 'Incomplete'
				},
			},
			'homeowners' : [
				{	
					'address-id' : '0000',
					'name' : 'Steven Wilson',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '422 Oxford Way',
					'last-sale-price' : 7.0,
					'last-sale-date' : '12/10/2013',
					'selling-agent' : 'Michael Jones',
					'blocked' : '',
					'past-client' : false,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0001',
					'name' : 'Kyle Morrison',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '18B E Carmel Valley Rd',
					'last-sale-price' : 2.2,
					'last-sale-date' : '2/07/2017',
					'selling-agent' : 'Kyle Morrison',
					'blocked' : '',
					'past-client' : true,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0002',
					'name' : 'Bill Jones',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '1215 Santa Barbara Lane',
					'last-sale-price' : 6.2,
					'last-sale-date' : '5/21/2012',
					'selling-agent' : 'Seamus Riley',
					'blocked' : '',
					'past-client' : false,
					'parcel-number' : '111-332-494'

				},
				{	
					'address-id' : '0003',
					'name' : 'Tom Hanks',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '1992 Wilson Place',
					'last-sale-price' : 10.875,
					'last-sale-date' : '6/23/1991',
					'selling-agent' : 'Meryl Streep',
					'blocked' : '',
					'past-client' : false,
					'parcel-number' : '111-332-494'
				},
				{	
					'address-id' : '0004',
					'name' : 'Steve Rodgers',
					'mail-address-line-1' : '522 Hannon Ave',
					'mail-address-line-2' : 'Monterey, CA 93940',
					'site-address' : '12 Marvel Dr',
					'last-sale-price' : 300,
					'last-sale-date' : '5/28/2015',
					'selling-agent' : 'Tony Stark',
					'blocked' : 'Homeowner-Blocked',
					'past-client' : false,
					'parcel-number' : '111-332-494'
				}
			],
			'final-preview' : {
				'Attention Grabber' : {
					'time-confirmed' : ''
				},
				'Front Graph' : {
					'time-confirmed' : ''
				},
				'Front Bar' : {
					'time-confirmed' : ''
				},
				'Top Image' : {
					'time-confirmed' : ''
				},
				'City Highlights' : {
					'time-confirmed' : ''
				},
				'Area Highlights' : {
					'time-confirmed' : ''
				},
				'Call To Action' : {
					'time-confirmed' : ''
				},
				'Inside Bar' : {
					'time-confirmed' : ''
				},
				'Listings And Sales' : {
					'time-confirmed' : ''
				}
			},
			'editor-complete' : false,
			'mailing-complete' : false,
			'total-complete' : false,
			'unblocked-mailings' : 4
		}
	},
	'personal-info' : {
		'Agent Logo' : '../../images/templates/logo.PNG',
		'Brokerage Logo' : '../../images/templates/sothebys.png',
		'Return Address 1' : '16B E Carmel Valley Rd',
		'Return Address 2' : 'Carmel Valley, CA 93924',
		'Mailing Address 1' : '',
		'Mailing Address 2' : '',
		'Front Website' : 'kylemorrisonhomes.com',
		'Phone Number' : '831-555-5555',
		'Email Address' : 'kyle@kylemorrison.com',
	},
	'total-mailings' : 0,
	'total-price' : 0
};

// section names to ids
const NAME_TO_ID = {
	'Attention Grabber' : 'attention-grabber',
	'Front Graph' : 'front-graph',
	'Front Bar' : 'front-bar',
	'Top Image' : 'top-image',
	'City Highlights' : 'city-highlights',
	'Area Highlights' : 'area-highlights',
	'Call To Action' : 'call-to-action',
	'Inside Bar' : 'inside-bar',
	'Listings And Sales' : 'listings-and-sales'
}

// section ids to names
const ID_TO_NAME = {
	'attention-grabber' : 'Attention Grabber',
	'front-graph' : 'Front Graph',
	'front-bar' : 'Front Bar',
	'top-image' : 'Top Image',
	'city-highlights' : 'City Highlights',
	'area-highlights' : 'Area Highlights',
	'call-to-action' : 'Call To Action',
	'inside-bar' : 'Inside Bar',
	'listings-and-sales' : 'Listings And Sales'
}

// price per mailing standard PMA
const mailingPrice = 1.6;

// W x H in inches of PMA
const PMA_SIZE = [17, 11];

// colors 
const STATUS_COLORS = {
	'Incomplete' : '#FF3A38',
	'Complete' : '#33C451',
};

// heights for the main window depending on the step
const WINDOW_HEIGHTS = {
	'Editor' : 'auto',
	'Mailing List' : 1060,
	'Final Preview' : 5000,
	'Incomplete' : 1060
};

// number of sections depending on type
const NUM_SECTIONS = {
	'mq-4' : 9
}

const PRICE_PER_MAILING = {
	'4' : 1.6,
	'5' : 2,
	'6' : 2.5
}

// month number to abbreviation
const MONTHS = {
	0 : 'Jan',
	1 : 'Feb',
	2 : 'Mar',
	3 : 'Apr',
	4 : 'May',
	5 : 'Jun',
	6 : 'Jul',
	7 : 'Aug',
	8 : 'Sep',
	9 : 'Oct',
	10 : 'Nov',
	11 : 'Dec'
}

// mailing list options
const mailingListOptions = {
	valueNames : ['address-id', 'parcel-number', 'blocked', 'name', 'mail-address-line-1', 'mail-address-line-2', 'site-address', 'last-sale-price', 'last-sale-date', 'selling-agent'],
	item: `<tr>
				<td><button class="edit-btn">EDIT</button</td>
			    <td class="address-id-container">
			        <div class="address-id"></div>
			        <strong class="parcel-number"></strong>
			    </td>
			    <td class="blocked-container">
			        <label class="check-container">
			            <input class="block-check" type="checkbox"/>
			            <span class="checkmark"><i class="material-icons">close</i></span>
			            <span class="blocked"></span>
		            </label>
	            </td>
	            <td class="name"></td>
	            <td class="mailing-address-container">
	            	<div class="mail-address-line-1"></div>
	            	<div class="mail-address-line-2"></div>
	            </td>
	            <td class="site-address"></td>
	            <td class="last-sale-price"></td>
	            <td class="last-sale-date"></td>
	            <td class="selling-agent"></td>
           </tr>`
};

/* Draw Image On Canvas
 * ---------------------
 * Draws the source image on the canvas at the specific size and coordinates.
 */
function drawImageOnCanvas(src, canvas, left, top, width, height) {
	let img = new Image();
	let context = canvas.getContext('2d');

	img.onload = () => {
		context.drawImage(img, left, top, width, height);
	};

	img.src = src;
	return img;
}

/* Returns the current date and time in a readable fashion - rounded to the minute */
function getDateAndTime() {
	const date = new Date();
	const day = date.getDate();
	const month = MONTHS[date.getMonth()];
	const year = date.getFullYear();
	const hour = date.getHours();
	const minute = date.getMinutes();
	return month + ' ' + day + ', ' + year + ' at ' + hour + ':' + minute;
}


const TOTAL_TITLE = 'All Approved Mailings';

/* Creates a box holding all pricing information of the current area */
function createPricingBox(area, numMailings, price, complete, current) {
	const total = (area === TOTAL_TITLE);
	const approved = (complete) ? 'Mailing List Approved' : 'Mailing List Not Approved';
	const totalPrice = (total) ? price : numMailings * price;
	let div = $('<div class="pricing-box"></div>');
	div.append($('<strong>' + area + '</strong><br>'));
	div.append($('<div class="num-mailings"><strong>' + numMailings + '</strong> mailings</div><br>'));
	if (!total) div.append($('<div>&times;</div><br>'));
	if (!total) div.append($('<div class="price"><strong>$' + price.toFixed(2) + '</strong> / mailing</div><br>'));
	div.append($('<div class="total">Total: <strong>$' + totalPrice.toFixed(2) + '</strong></div><br>'));
	if (!total) div.append($('<div class="approved"><strong>' + approved + '</strong></div>'));
	if (complete) div.addClass('complete');
	if (current) div.addClass('current');
	if (total) div.addClass('total');
	return div;
}

/* Updates the pricing box with a new number of mailings and therefore total cost */
function updatePricingBox(box, numMailings, price, complete) {
	const approved = (complete) ? 'Mailing List Approved' : 'Mailing List Not Approved';
	const total = box.hasClass('total');
	const totalPrice = (total) ? price : numMailings * price;
	if (complete) 
		box.addClass('complete');
	else
		box.removeClass('complete');
	box.children('.num-mailings').html('<strong>' + numMailings + ' mailings</strong>');
	box.children('.total').html('Total: <strong>$' + totalPrice.toFixed(2) + '</strong>');
	if (!total) box.children('.approved').html('<strong>' + approved + '</strong>');
}

function addTooltip(container, message) {
	container.addClass('tooltip');
	container.append($('<div class="tooltiptext">' + message + '</div>'));
}

// Updates all text on the creator with the current information
function updateCurrentAreaText() { $('.insert-current-area').html(currentArea); }
function updateCurrentStepText() { $('.insert-current-step').html(currentStep); }
function updateCurrentVersionText() { $('.insert-current-version').html(version); }